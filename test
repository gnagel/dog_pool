#!/bin/sh

export GOPATH=$PWD/
export GOMAXPROCS=1


# Abort on errors after this point ...
set -e


echo ""
echo ".................................................................."
echo "Installing dependencies .........................................."
echo ".................................................................."
echo ""

go get "github.com/fzzy/radix/redis"
go get "github.com/alecthomas/log4go"
go get "github.com/jessevdk/go-flags"
go get "github.com/bradfitz/gomemcache/memcache"
go get "github.com/jteeuwen/go-bindata"
go get "github.com/orfjackal/gospec/src/gospec"
go get "github.com/samuel/go-thrift/thrift"
go get "github.com/samuel/go-thrift/generator"
go get "github.com/samuel/go-thrift/parser"
go get "github.com/sdming/goh"


echo ""
echo ".................................................................."
echo "Formatting the code .............................................."
echo ".................................................................."
gofmt -s -w $GOPATH/dog_pool
gofmt -s -w $GOPATH/dog_pool_utils
echo ""


# Run the tests
# This will run the "all_spec_test.go" suite of tests
echo ""
echo ".................................................................."
echo "Running tests ...................................................."
echo ".................................................................."
echo ""

# 
# Run the tests
# 
go test -v ./dog_pool/... || exit $?
go test -v ./dog_pool_utils/... || exit $?

echo ""
echo ".................................................................."
echo "Finished tests ..................................................."
echo ".................................................................."
echo ""
